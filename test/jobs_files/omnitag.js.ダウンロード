!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c4c6d8e1-4ae8-414f-953f-60007e86a0b2",e._sentryDebugIdIdentifier="sentry-dbid-c4c6d8e1-4ae8-414f-953f-60007e86a0b2")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"20251126-062603"},(()=>{"use strict";var e,t={4469:(e,t,n)=>{n.d(t,{$3:()=>c,$Q:()=>u,Dt:()=>v,HH:()=>g,NP:()=>m,R2:()=>_,d8:()=>f});var r=n(360);const i="?";function createFrame(e,t,n,r){const i={filename:e,function:t,in_app:!0};return void 0!==n&&(i.lineno=n),void 0!==r&&(i.colno=r),i}const o=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,a=/\((\S*)(?::(\d+))(?::(\d+))\)/,c=[30,e=>{const t=o.exec(e);if(t){if(t[2]&&0===t[2].indexOf("eval")){const e=a.exec(t[2]);e&&(t[2]=e[1],t[3]=e[2],t[4]=e[3])}const[e,n]=extractSafariExtensionDetails(t[1]||i,t[2]);return createFrame(n,e,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}}],s=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,l=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,u=[50,e=>{const t=s.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const e=l.exec(t[3]);e&&(t[1]=t[1]||"eval",t[3]=e[1],t[4]=e[2],t[5]="")}let e=t[3],n=t[1]||i;return[n,e]=extractSafariExtensionDetails(n,e),createFrame(e,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}}],d=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,_=[40,e=>{const t=d.exec(e);return t?createFrame(t[2],t[1]||i,+t[3],t[4]?+t[4]:void 0):void 0}],p=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,m=[10,e=>{const t=p.exec(e);return t?createFrame(t[2],t[3]||i,+t[1]):void 0}],w=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\(.*\))? in (.*):\s*$/i,g=[20,e=>{const t=w.exec(e);return t?createFrame(t[5],t[3]||t[4]||i,+t[1],+t[2]):void 0}],f=[c,u,_],v=(0,r.pE)(...f),extractSafariExtensionDetails=(e,t)=>{const n=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return n||r?[-1!==e.indexOf("@")?e.split("@")[0]:i,n?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]}},360:(e,t,n)=>{n.d(t,{$P:()=>getFunctionName,Sq:()=>stackParserFromStackParserOptions,pE:()=>createStackParser});const r=50,i=/\(error: (.*)\)/,o=/captureMessage|captureException/;function createStackParser(...e){const t=e.sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));return(e,n=0)=>{const a=[],c=e.split("\n");for(let e=n;e<c.length;e++){const n=c[e];if(n.length>1024)continue;const o=i.test(n)?n.replace(i,"$1"):n;if(!o.match(/\S*Error: /)){for(const e of t){const t=e(o);if(t){a.push(t);break}}if(a.length>=r)break}}return function stripSentryFramesAndReverse(e){if(!e.length)return[];const t=Array.from(e);/sentryWrapped/.test(t[t.length-1].function||"")&&t.pop();t.reverse(),o.test(t[t.length-1].function||"")&&(t.pop(),o.test(t[t.length-1].function||"")&&t.pop());return t.slice(0,r).map((e=>({...e,filename:e.filename||t[t.length-1].filename,function:e.function||"?"})))}(a)}}function stackParserFromStackParserOptions(e){return Array.isArray(e)?createStackParser(...e):e}const a="<anonymous>";function getFunctionName(e){try{return e&&"function"==typeof e&&e.name||a}catch(e){return a}}},4433:(e,t,n)=>{function pushToErrorQueue(e){var t,n;if((null===(t=window.__omnitagErrorQueue)||void 0===t?void 0:t.length)>=1e3)return;!1===(null===(n=window.__omnitagErrorQueue)||void 0===n?void 0:n.some((t=>e.message?"".concat(t.message,"-").concat(JSON.stringify(t.captureContext))==="".concat(e.message,"-").concat(JSON.stringify(e.captureContext)):"".concat(t.exception,"-").concat(JSON.stringify(t.captureContext))==="".concat(e.exception,"-").concat(JSON.stringify(e.captureContext)))))&&window.__omnitagErrorQueue.push(e)}n.d(t,{Z:()=>pushToErrorQueue})},3564:(e,t,n)=>{n.d(t,{EI:()=>captureScopeMessage,OD:()=>s,j6:()=>c,jo:()=>closeSentryScopeClient,mO:()=>captureScopeException,nb:()=>isBuildFiles});var r=n(9964);let i;window.__omnitagErrorQueue=[],window.__isOmnitagSentryGlobalInitialized=!1;const withSentry=e=>async function(){const t=await(async()=>i?null:Promise.all([n.e(229),n.e(631)]).then(n.bind(n,7967)))();if(t){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e(t,...o)}},o={dsn:"https://09d9c942a64ac2170ccd5a88574846e7@o4506693258641408.ingest.us.sentry.io/4506693263818752",environment:window.__omnitagLatestSelected?"latest":"production",ignoreErrors:[/\[webpack-dev-server\] \[object Event\]/,/Network/i,/Internet/i,/aborted/i,/Failed to fetch/,/Load failed/i,/cancelled/i,/Time limit/i,/Failed to read the 'localStorage' property/i,/SecurityError.*localstorage/i,/SecurityError: The operation is insecure/i,/NS_ERROR_FAILURE/,/NS_ERROR_FILE_CORRUPTED/],sampleRate:.1},a="undefined"!=typeof process&&"true"===process.env.VITEST,c=withSentry((async function(e){let{tid:t,logLevel:r=[],transport:i,sampleRate:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=r.length>0&&await Promise.all([n.e(229),n.e(722)]).then(n.bind(n,3015));e.init({...o,integrations:[...s&&s.captureConsoleIntegration?[s.captureConsoleIntegration({levels:r})]:[]],beforeSend(e){if(function checkIsOurFile(e){var t;const n=function getRootFrame(e){var t,n;if(null!==(t=e.exception)&&void 0!==t&&null!==(n=t.values)&&void 0!==n&&n[0]){var r;const t=null===(r=e.exception.values[0].stacktrace)||void 0===r?void 0:r.frames;return null==t?void 0:t[t.length-1]}return}(e);if(null!=n&&n.filename)return isBuildFiles(n.filename);return!(null===(t=e.tags)||void 0===t||!t.omnitagErrType)}(e)){var t,n,r;e.tags={...e.tags,isOmnitag:!0};const i=null!==(t=null===(n=e.exception)||void 0===n||null===(r=n.values)||void 0===r?void 0:r[0])&&void 0!==t?t:{};return i.type&&i.value&&(e.fingerprint=[i.type,i.value]),e}return null},initialScope:{tags:{tid:t}},...a?{transport:i,sampleRate:c}:{}}),window.__isOmnitagSentryGlobalInitialized=!0,processErrorQueue((t=>{let{message:n,hint:r,exception:i,captureContext:o}=t;n?e.captureMessage(n,o):i&&e.captureException(i,r)}))})),s=withSentry((async function(e){let{tid:t,transport:n,sampleRate:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{BrowserClient:c,defaultStackParser:s,getDefaultIntegrations:l,makeFetchTransport:u,Scope:d}=e,_=l({}).filter((e=>!["BrowserApiErrors","Breadcrumbs","GlobalHandlers"].includes(e.name))),p=new c({...o,enabled:!0,transport:a?n:u,...a?{sampleRate:r}:{},stackParser:s,integrations:_});return i=new d,i.setClient(p),i.setTags({isOmnitag:!0,tid:t}),p.init(),processErrorQueue((e=>{let{message:t,hint:n,exception:r,captureContext:o}=e;var a;if(t)null===(a=i)||void 0===a||a.captureMessage(t,"error",{captureContext:o});else if(r){var c;null===(c=i)||void 0===c||c.captureException(r,n)}})),p})),captureScopeMessage=(e,t,n)=>{i&&i.captureMessage(e,t,n)},captureScopeException=(e,t)=>{i&&i.captureException(e,t)};const isBuildFiles=e=>{try{const t=new URL(e);return Object.values(r.lA).map((e=>new URL(e).hostname)).includes(t.hostname)}catch(e){return!1}},processErrorQueue=e=>{setInterval((()=>{const t=window.__omnitagErrorQueue.shift();t&&e(t)}),1e3)},closeSentryScopeClient=async e=>{await(null==e?void 0:e.close()),i=void 0}},9964:(e,t,n)=>{n.d(t,{RX:()=>r,_1:()=>a,kO:()=>c,lA:()=>i,nX:()=>o});let r=function(e){return e.DEV="http://localhost:8000",e.TW="https://analytics.omniscientai.com",e.TW_STAGING="https://staging.omnicloud.tech",e.JP="https://jp.analytics.omnisegment.com",e.JP_POC="https://jp-poc.omnisegment.com",e.FUBON="https://tcdpapi.taipeifubon.com.tw",e}({});const i={PRODUCTION:"https://omnitag.omniscientai.com/",STAGING:"https://omnitag-staging.omniscientai.com/",LEGACY:"https://usergram.omniscientai.com/"},o={Shopline:"shopline","91App":"91app",Shopify:"shopify",Cyberbiz:"cyberbiz",Custom:"custom"},a={Home:"home_page",ProductList:"product_list_page",ProductDetail:"product_detail_page",Checkout:"checkout_page",Custom:"custom_page"},c={After:"after",Before:"before",Append:"append",Prepend:"prepend"}},1209:(e,t,n)=>{function takeSettingWithEnv(e){return e.production||e.production}function matchUrl(e){const t=window.location.pathname+window.location.search,n=e.replace(/[\\^$.?+(){|}]/g,"\\$&").replace(/\*/g,".*");return new RegExp("^".concat(n,"$"),"i").test(t)}n.d(t,{D1:()=>matchUrl,q4:()=>takeSettingWithEnv})},5131:(e,t,n)=>{async function waitUntil(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;const r=Date.now();for(;Date.now()-r<n;){const n=e();if(n)return n;await new Promise((e=>setTimeout(e,t)))}throw new Error("Time limit exceeded")}n.d(t,{A:()=>waitUntil})}},n={};function __webpack_require__(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.m=t,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,n)=>(__webpack_require__.f[n](e,t),t)),[])),__webpack_require__.u=e=>(({386:"ai-recommender",410:"init",541:"chunk-omni-ai-chat-widget-f1f98bdd",631:"sentry-browser",722:"sentry-integrations",794:"chunk-omni-ai-chat-widget-5933e964",796:"webbanner-embed",855:"interaction",879:"ai-chat-widget",915:"omni-webpush"}[e]||e)+".js"),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},__webpack_require__.l=(t,n,r,i)=>{if(e[t])e[t].push(n);else{var o,a;if(void 0!==r)for(var c=document.getElementsByTagName("script"),s=0;s<c.length;s++){var l=c[s];if(l.getAttribute("src")==t){o=l;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.src=t),e[t]=[n];var onScriptComplete=(n,r)=>{o.onerror=o.onload=null,clearTimeout(u);var i=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((e=>e(r))),n)return n(r)},u=setTimeout(onScriptComplete.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=onScriptComplete.bind(null,o.onerror),o.onload=onScriptComplete.bind(null,o.onload),a&&document.head.appendChild(o)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),(()=>{var e={126:0,334:0};__webpack_require__.f.j=(t,n)=>{var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var o=__webpack_require__.p+__webpack_require__.u(t),a=new Error;__webpack_require__.l(o,(n=>{if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var webpackJsonpCallback=(t,n)=>{var r,i,[o,a,c]=n,s=0;if(o.some((t=>0!==e[t]))){for(r in a)__webpack_require__.o(a,r)&&(__webpack_require__.m[r]=a[r]);if(c)c(__webpack_require__)}for(t&&t(n);s<o.length;s++)i=o[s],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},t=self["omnitag-webpackChunk"]=self["omnitag-webpackChunk"]||[];t.forEach(webpackJsonpCallback.bind(null,0)),t.push=webpackJsonpCallback.bind(null,t.push.bind(t))})(),__webpack_require__.nc=void 0,(()=>{var e=__webpack_require__(3564),t=__webpack_require__(4433),n=__webpack_require__(4469);var r=__webpack_require__(1209),i=__webpack_require__(5131),o=__webpack_require__(9964);const a={DEV:"http://localhost:7001/route-config.dev.json",STAGING:"https://omnitag-staging.omnisegment.com/route-config.json",PROD:"https://omnitag.omnisegment.com/route-config.json"};const loadLatestScript=async e=>{const{scriptId:t,element:n}=await getScriptDetails()||{},r=document.createElement("script");t&&(null==n||n.remove(),window.__omnitagLatestSelected=!0,r.async=!0,r.src="".concat(e,"?id=").concat(t),r.crossOrigin="anonymous",document.head.appendChild(r))},loadStableScript=async()=>{const{scriptUrl:e,element:t}=await getScriptDetails()||{},n=document.createElement("script");e&&(null==t||t.remove(),window.__omnitagLatestSelected=!1,n.async=!0,n.src="".concat(e),n.crossOrigin="anonymous",document.head.appendChild(n))};async function getScriptDetails(){var t,n;const a=document.querySelector('script[src*="omnitag.js"], script[src*="/tag-app.js"]');if(!a&&!window.i13nData){if(!["tw.misumi-ec.com","stg0-tw.misumi-ec.com"].includes(window.location.hostname)){const t=await(0,e.OD)();(0,e.EI)("Omnitag script element not found and window.i13nData is undefined from router.js","error",{captureContext:{tags:{omnitagErrType:"initialize"}}}),await(0,e.jo)(t)}return}const c=(0,r.q4)({development:new URL("http://localhost:7001/omnitag.js"),production:null!=a&&a.src?new URL(a.src):(null===(t=window.i13nData)||void 0===t?void 0:t.omnitagHostEnv)&&new URL("".concat(o.lA[null===(n=window.i13nData)||void 0===n?void 0:n.omnitagHostEnv],"omnitag.js"))});if(!c)throw new Error("Cannot create scriptURL in router.js");const s=await async function getScriptId(e,t){const getScriptIdByEnv=()=>{var n,i;return(0,r.q4)({development:"OA-c19eb6",production:new URLSearchParams(e.search).get("id")||(null===(n=window.i13nData)||void 0===n?void 0:n.tagId)||(null==t||null===(i=t.dataset)||void 0===i?void 0:i.tid)})};try{await(0,i.A)(getScriptIdByEnv,200,1e4)}catch(e){const t="Cannot get scriptId from router.js Error: ".concat(e);throw new Error(t)}return getScriptIdByEnv()}(c,a);return{scriptId:s,scriptUrl:c,element:a}}const isErrorShouldBeSent=e=>{const t=e instanceof Error&&["removeItem","getItem","setItem"].some((t=>e.message.includes(t))),n=["tlc.tokai.jp","hibuying.hilife.com.tw","crowdworks.jp"].includes(window.location.hostname);return!t||!n};window.__omnitagRouted?Promise.all([__webpack_require__.e(376),__webpack_require__.e(410)]).then(__webpack_require__.bind(__webpack_require__,3253)).then((e=>{let{init:t}=e;t()})):(window.addEventListener("omnitag-error",(e=>{const n=e,{error:r}=n.detail;r instanceof Error?(0,t.Z)({exception:r}):(0,t.Z)({message:r})})),window.addEventListener("error",(n=>{window.__isOmnitagSentryGlobalInitialized||(0,e.nb)(n.filename)&&(0,t.Z)({exception:n.error})})),window.addEventListener("unhandledrejection",(r=>{var i;if(!window.__isOmnitagSentryGlobalInitialized){if(r.reason instanceof Error&&r.reason.stack){var o;const i=(0,n.Dt)(r.reason.stack),a=null===(o=i[i.length-1])||void 0===o?void 0:o.filename;if(a&&(0,e.nb)(a))return void(0,t.Z)({exception:r.reason})}if((null===(i=r.detail)||void 0===i?void 0:i.reason)instanceof Error&&r.detail.reason.stack){var a;const i=(0,n.Dt)(r.reason.stack),o=null===(a=i[i.length-1])||void 0===a?void 0:a.filename;o&&(0,e.nb)(o)&&(0,t.Z)({exception:r.detail.reason})}}})),async function route(){try{const{enable:e,fileUrl:t,probability:n}=await async function fetchConfig(){const{scriptUrl:e}=await getScriptDetails()||{},t=null!=e&&e.origin.includes("omnitag-staging.omniscientai.com")?a.STAGING:a.PROD;return(await fetch(t)).json()}();if(!e)return localStorage.removeItem("OmnitagLatestSelected"),void await loadStableScript();const r=localStorage.getItem("OmnitagLatestSelected");if("true"===new URLSearchParams(window.location.search).get("omnitag_latest")||"true"===r)return localStorage.setItem("OmnitagLatestSelected","true"),window.__omnitagLatestSelected=!0,void await loadLatestScript(t);if("false"===r)return void await loadStableScript();if(null==r){const e=Math.random()<=n;return localStorage.setItem("OmnitagLatestSelected",String(e)),window.__omnitagLatestSelected=e,void(e?await loadLatestScript(t):await loadStableScript())}return localStorage.removeItem("OmnitagLatestSelected"),void await loadStableScript()}catch(t){if(console.error("Route error. Falling back to default.",t),await loadStableScript(),isErrorShouldBeSent(t)){const n=await(0,e.OD)();(0,e.mO)(t,{captureContext:{tags:{omnitagErrType:"route-error"}}}),await(0,e.jo)(n)}}}().finally((()=>{window.__omnitagRouted=!0})))})()})();
//# sourceMappingURL=omnitag.js.map